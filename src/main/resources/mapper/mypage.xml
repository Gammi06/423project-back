<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="site.metacoding.miniproject1.domain.applicationStatus.ApplicationStatusDao">

    <insert id="insert">
		
	</insert>

    <select id="findAll" resultType="site.metacoding.miniproject1.web.dto.response.StatusInfoDto">
        SELECT apps.id id, apps.wanted_id wantedId, 
        apps.resume_id resumeId, apps.state state, 
        apps.created created, wan.position_code_name positionCodeName, 
        wan.company_id companyId, com.company_name companyName
        FROM application_status apps
        INNER JOIN wanteds wan
        ON apps.wanted_id = wan.id
        INNER JOIN companys com
        ON wan.company_id = com.id
        <if test="keyword != null">
            WHERE com.company_name LIKE CONCAT('%',#{keyword},'%')
        </if>
        ORDER BY apps.id DESC
	</select>

    <select id="findCounts" resultType="site.metacoding.miniproject1.web.dto.response.StatusCountDto">
        SELECT count((IFNULL(state, 0))) AS statusAll, 
        (SELECT count((IFNULL(state, 0))) AS statusC
        FROM application_status
        WHERE state = 0) statusC,
        (SELECT count((IFNULL(state, 0))) AS statusFinal
        FROM application_status
        WHERE state = 1) statusFinal
        FROM application_status
    </select>

    <select id="findWaiting" resultType="site.metacoding.miniproject1.web.dto.response.StatusWaitingInfoDto">
        SELECT apps.id id, apps.wanted_id wantedId, 
        apps.resume_id resumeId, apps.state state, 
        apps.created created, wan.position_code_name positionCodeName, 
        wan.company_id companyId, com.company_name companyName
        FROM application_status apps
        INNER JOIN wanteds wan
        ON apps.wanted_id = wan.id
        INNER JOIN companys com
        ON wan.company_id = com.id 
        WHERE apps.state = 0 
        <if test="keyword != null">
            AND com.company_name LIKE CONCAT('%',#{keyword},'%')
        </if>
        ORDER BY apps.id DESC
	</select>

    <insert id="update">
		
	</insert>

    <insert id="deleteById">
		
	</insert>

</mapper>